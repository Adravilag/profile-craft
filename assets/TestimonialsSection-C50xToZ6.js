import{R as l,v as Ne,j as e,M as ye,A as N,B as we,C as Ce,D as Te,E as Se}from"./index-CQ6-uO2I.js";import{F as Ee}from"./FloatingActionButtonGroup-DTivYC0F.js";import{A as $e,a as n}from"./AdminModal-r6pp9zG0.js";import{H as Ae}from"./HeaderSection-EkqSG3K4.js";const ke="_testimonials_iidfm_53",Le="_expanded_iidfm_117",Ie="_star_iidfm_617",Fe="_primary_iidfm_998",s={testimonials:ke,"testimonials-grid":"_testimonials-grid_iidfm_66","testimonial-card":"_testimonial-card_iidfm_93",expanded:Le,"testimonial-animate":"_testimonial-animate_iidfm_271","testimonial-header":"_testimonial-header_iidfm_285","testimonial-avatar-wrapper":"_testimonial-avatar-wrapper_iidfm_293","testimonial-avatar":"_testimonial-avatar_iidfm_293","testimonial-body":"_testimonial-body_iidfm_349","testimonial-text-container":"_testimonial-text-container_iidfm_360","testimonial-text":"_testimonial-text_iidfm_360","read-more-btn":"_read-more-btn_iidfm_526","rating-stars":"_rating-stars_iidfm_590",star:Ie,"star-filled":"_star-filled_iidfm_622","star-empty":"_star-empty_iidfm_627","testimonial-date":"_testimonial-date_iidfm_642","testimonial-footer":"_testimonial-footer_iidfm_501","testimonial-author":"_testimonial-author_iidfm_669","author-info":"_author-info_iidfm_677","author-name":"_author-name_iidfm_685","author-position":"_author-position_iidfm_692","author-website":"_author-website_iidfm_699","testimonial-actions":"_testimonial-actions_iidfm_726","edit-btn":"_edit-btn_iidfm_741","delete-btn":"_delete-btn_iidfm_742","empty-state":"_empty-state_iidfm_782","empty-icon":"_empty-icon_iidfm_788","empty-title":"_empty-title_iidfm_793","empty-description":"_empty-description_iidfm_798","modal-overlay":"_modal-overlay_iidfm_809","modal-content":"_modal-content_iidfm_821","modal-header":"_modal-header_iidfm_832","modal-title":"_modal-title_iidfm_839","modal-close":"_modal-close_iidfm_844","modal-form":"_modal-form_iidfm_864","form-grid":"_form-grid_iidfm_870","form-group":"_form-group_iidfm_876","optional-toggle-btn":"_optional-toggle-btn_iidfm_882","optional-hide-btn":"_optional-hide-btn_iidfm_883","optional-fields":"_optional-fields_iidfm_908","modal-actions":"_modal-actions_iidfm_914","btn-secondary":"_btn-secondary_iidfm_921","btn-primary":"_btn-primary_iidfm_936","testimonial-form":"_testimonial-form_iidfm_966","admin-form":"_admin-form_iidfm_966","form-row":"_form-row_iidfm_975","action-button":"_action-button_iidfm_989",primary:Fe},L={name:"",position:"",text:"",email:"",company:"",website:""},qe=({testimonials:u,onAdd:X,onEdit:Y,onDelete:Z,isAdminMode:x=!1,showAdminFAB:ee=!1,onAdminClick:q})=>{const[r,_]=l.useState(L),[f,y]=l.useState(null),[H,I]=l.useState(null),[z,j]=l.useState(!1),[ae,w]=l.useState(!1),[se,M]=l.useState(!1),[C,G]=l.useState(!1),[F,te]=l.useState([]),[D,T]=l.useState([]),[ie,V]=l.useState(!1),[c,ne]=l.useState("pending"),{showSuccess:S,showError:E}=Ne(),R=l.useRef(null),[oe,le]=l.useState(new Set),O=a=>a.length>300,re=(a,t)=>!O(a)||t?a:a.substring(0,300)+"...",ce=a=>{le(t=>{const o=new Set(t),g=!o.has(a);if(o.has(a)?o.delete(a):o.add(a),g)setTimeout(()=>{const i=document.getElementById(`testimonial-text-${a}`),d=i==null?void 0:i.closest(`.${s["testimonial-card"]}`),h=i==null?void 0:i.closest(`.${s["testimonial-text-container"]}`);d&&i&&h&&(i.classList.add(s.expanding),d.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"}),d.classList.add(s["testimonial-animate"]),setTimeout(()=>{if(i){if(i.scrollHeight>i.clientHeight){i.classList.add("has-scroll"),h.classList.add("has-scroll");const v=()=>{const k=i.scrollTop,p=i.scrollHeight,P=i.clientHeight,U=k/(p-P)*100;h.style.setProperty("--scroll-percentage",`${U}%`),U>95?h.classList.add("scroll-end-reached"):h.classList.remove("scroll-end-reached")};i.addEventListener("scroll",v),setTimeout(()=>{i.removeEventListener("scroll",v)},3e4)}else i.classList.remove("has-scroll"),h.classList.remove("has-scroll");setTimeout(()=>{i.classList.remove(s.expanding)},600)}d.classList.remove(s["testimonial-animate"])},200))},100);else{const i=document.getElementById(`testimonial-text-${a}`),d=i==null?void 0:i.closest(`.${s["testimonial-text-container"]}`);i&&d&&(i.classList.remove("has-scroll"),d.classList.remove("has-scroll"),d.classList.remove("scroll-end-reached"),d.style.removeProperty("--scroll-percentage"))}return o})},de=a=>{if(!a)return"";try{return new Date(a).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"})}catch{return""}};l.useEffect(()=>{const a=()=>{if(!R.current)return;const t=R.current.getBoundingClientRect();t.top<=(window.innerHeight||document.documentElement.clientHeight)/2&&t.bottom>=100?(document.body.classList.add("testimonials-section-active"),M(!0)):(document.body.classList.remove("testimonials-section-active"),M(!1))};return a(),window.addEventListener("scroll",a),()=>window.removeEventListener("scroll",a)},[]);const m=a=>{const{name:t,value:o}=a.target;_(g=>({...g,[t]:o}))},W=a=>{a.preventDefault(),f?(Y(f,r),I(f)):(X({...r,user_id:1,order_index:u.length}),I(-1)),_(L),y(null),j(!1),w(!1),setTimeout(()=>I(null),800)},me=a=>{_({name:a.name,position:a.position,text:a.text,email:"",company:a.company||"",website:a.website||""}),y(a.id),w(!0),(a.company||a.website)&&j(!0)},B=()=>{w(!1),_(L),y(null),j(!1)},he=a=>{a.currentTarget.src="/assets/images/foto-perfil.jpg"},pe=(a=5)=>{const t=[];for(let o=1;o<=5;o++)t.push(e.jsx("span",{className:`${s.star} ${o<=a?s["star-filled"]:s["star-empty"]}`,"aria-hidden":"true",children:"★"},o));return e.jsx("div",{className:s["rating-stars"],children:t})},b=async()=>{try{V(!0);const a=await N(c==="all"?void 0:c);if(te(a),D.length===0){const t=await N();T(t)}}catch(a){console.error("Error loading admin testimonials:",a),E("Error al cargar testimonios")}finally{V(!1)}};l.useEffect(()=>{C&&b()},[c,C]);const Q=async a=>{try{await Ce(a,F.length),S("Testimonio aprobado");const t=await N();T(t),b()}catch{E("Error al aprobar testimonio")}},J=async a=>{try{await Te(a),S("Testimonio rechazado");const t=await N();T(t),b()}catch{E("Error al rechazar testimonio")}},fe=async a=>{if(confirm("¿Estás seguro de que quieres eliminar este testimonio?"))try{await Se(a),S("Testimonio eliminado");const t=await N();T(t),b()}catch{E("Error al eliminar testimonio")}},ue=a=>a.email&&a.email.includes("@")?`https://www.gravatar.com/avatar/${we(a.email.toLowerCase().trim())}?d=identicon&s=150`:"/assets/images/foto-perfil.jpg",xe=a=>{switch(a){case"approved":return"#4caf50";case"rejected":return"#f44336";case"pending":return"#ff9800";default:return"#9e9e9e"}},_e=a=>{switch(a){case"approved":return"Aprobado";case"rejected":return"Rechazado";case"pending":return"Pendiente";default:return"Desconocido"}},je=()=>{G(!1)},$=()=>ie?e.jsxs("div",{className:n.adminLoading,children:[e.jsx("i",{className:"fas fa-spinner fa-spin"}),e.jsx("p",{children:"Cargando testimonios..."})]}):F.length===0?e.jsxs("div",{className:n.adminEmpty,children:[e.jsx("i",{className:"fas fa-inbox"}),e.jsxs("h3",{children:["No hay testimonios ",be()]}),e.jsxs("p",{children:[c==="pending"&&"No hay testimonios pendientes de revisión.",c==="approved"&&"No hay testimonios aprobados.",c==="rejected"&&"No hay testimonios rechazados.",c==="all"&&"No hay testimonios en el sistema."]})]}):e.jsx("div",{className:n.adminItemsList,children:F.map(a=>e.jsxs("div",{className:n.adminItemCard,children:[e.jsxs("div",{className:n.adminCardRow,children:[e.jsxs("div",{className:n.adminItemHeader,children:[e.jsx("div",{className:n.adminItemImage,children:e.jsx("img",{src:ue(a),alt:`Avatar de ${a.name}`,className:n.testimonialAvatar})}),e.jsxs("div",{className:n.adminItemInfo,children:[e.jsx("h3",{children:a.name}),e.jsxs("p",{className:n.adminItemSubtitle,children:[a.position,a.company&&` en ${a.company}`]}),a.email&&e.jsxs("p",{className:n.adminItemContact,children:[e.jsx("i",{className:"fas fa-envelope"}),a.email]}),a.website&&e.jsxs("p",{className:n.adminItemContact,children:[e.jsx("i",{className:"fas fa-link"}),e.jsx("a",{href:a.website.startsWith("http")?a.website:`https://${a.website}`,target:"_blank",rel:"noopener noreferrer",children:a.website})]})]})]}),e.jsxs("div",{className:n.adminItemStatus,children:[e.jsx("span",{className:n.statusBadge,style:{backgroundColor:xe(a.status||"pending")},children:_e(a.status||"pending")}),a.created_at&&e.jsxs("span",{className:n.adminItemDate,children:[e.jsx("i",{className:"fas fa-calendar-alt"}),new Date(a.created_at).toLocaleDateString("es-ES")]})]})]}),"            ",e.jsxs("div",{className:n.adminCardRow,children:[e.jsx("div",{className:n.adminItemContent,children:e.jsx("p",{className:n.testimonialText,children:a.text})}),e.jsxs("div",{className:n.adminItemActions,children:[a.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:n.adminBtnPrimary,onClick:()=>Q(a.id),title:"Aprobar este testimonio",children:[e.jsx("i",{className:"fas fa-check"}),"Aprobar"]}),e.jsxs("button",{className:n.adminBtnSecondary,onClick:()=>J(a.id),title:"Rechazar este testimonio",children:[e.jsx("i",{className:"fas fa-times"}),"Rechazar"]})]}),a.status==="rejected"&&e.jsxs("button",{className:n.adminBtnPrimary,onClick:()=>Q(a.id),title:"Aprobar este testimonio",children:[e.jsx("i",{className:"fas fa-check"}),"Aprobar"]}),a.status==="approved"&&e.jsxs("button",{className:n.adminBtnSecondary,onClick:()=>J(a.id),title:"Quitar aprobación",children:[e.jsx("i",{className:"fas fa-ban"}),"Quitar aprobación"]}),e.jsxs("button",{className:n.adminBtnDanger,onClick:()=>fe(a.id),title:"Eliminar permanentemente",children:[e.jsx("i",{className:"fas fa-trash"}),"Eliminar"]})]})]})]},a.id))}),be=()=>{switch(c){case"pending":return"pendientes";case"approved":return"aprobados";case"rejected":return"rechazados";default:return""}},A=a=>a==="all"?D.length:D.filter(t=>t.status===a).length,ge=[{id:"pending",label:`Pendientes (${A("pending")})`,icon:"fas fa-clock",content:c==="pending"?$():e.jsx("div",{children:"Cargando..."})},{id:"approved",label:`Aprobados (${A("approved")})`,icon:"fas fa-check",content:c==="approved"?$():e.jsx("div",{children:"Cargando..."})},{id:"rejected",label:`Rechazados (${A("rejected")})`,icon:"fas fa-times",content:c==="rejected"?$():e.jsx("div",{children:"Cargando..."})},{id:"all",label:`Todos (${A("all")})`,icon:"fas fa-list",content:c==="all"?$():e.jsx("div",{children:"Cargando..."})}],ve=a=>{ne(a)};return e.jsxs("section",{id:"testimonials",className:"section-cv","aria-label":"Testimonios",ref:R,children:[e.jsx(Ae,{icon:"fas fa-comments",title:"Testimonios",subtitle:"Lo que dicen quienes han trabajado conmigo",className:s.testimonials}),"      ",ae&&e.jsx(ye,{children:e.jsx("div",{className:s["modal-overlay"],onClick:B,children:e.jsxs("div",{className:s["modal-content"],onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:s["modal-header"],children:[e.jsxs("h3",{className:s["modal-title"],children:[e.jsx("i",{className:"fas fa-quote-left"}),f?"Editar Testimonio":"Añadir Nuevo Testimonio"]}),e.jsx("button",{className:s["modal-close"],onClick:B,"aria-label":"Cerrar modal",children:e.jsx("i",{className:"fas fa-times"})})]}),e.jsxs("form",{className:s["modal-form"],onSubmit:W,children:[e.jsxs("div",{className:s["form-grid"],children:[e.jsxs("div",{className:s["form-group"],children:[e.jsx("label",{htmlFor:"name",children:"Nombre *"}),e.jsx("input",{id:"name",name:"name",value:r.name,onChange:m,placeholder:"Tu nombre completo",required:!0})]}),e.jsxs("div",{className:s["form-group"],children:[e.jsx("label",{htmlFor:"position",children:"Puesto *"}),e.jsx("input",{id:"position",name:"position",value:r.position,onChange:m,placeholder:"Tu puesto de trabajo",required:!0})]})]}),e.jsxs("div",{className:s["form-group"],children:[e.jsx("label",{htmlFor:"text",children:"Testimonio *"}),e.jsx("textarea",{id:"text",name:"text",value:r.text,onChange:m,placeholder:"Comparte tu experiencia trabajando conmigo...",required:!0,rows:4})]}),!z&&e.jsxs("button",{type:"button",className:s["optional-toggle-btn"],onClick:()=>j(!0),children:[e.jsx("i",{className:"fas fa-plus-circle"}),"Añadir información adicional (opcional)"]}),z&&e.jsxs("div",{className:s["optional-fields"],children:[e.jsxs("div",{className:s["form-grid"],children:[e.jsxs("div",{className:s["form-group"],children:[e.jsx("label",{htmlFor:"email",children:"Email"}),e.jsx("input",{id:"email",name:"email",type:"email",value:r.email,onChange:m,placeholder:"email@ejemplo.com"}),e.jsx("small",{children:"Para mostrar tu avatar de Gravatar"})]}),e.jsxs("div",{className:s["form-group"],children:[e.jsx("label",{htmlFor:"company",children:"Empresa"}),e.jsx("input",{id:"company",name:"company",value:r.company,onChange:m,placeholder:"Nombre de la empresa"})]})]}),e.jsxs("div",{className:s["form-group"],children:[e.jsx("label",{htmlFor:"website",children:"Sitio Web"}),e.jsx("input",{id:"website",name:"website",type:"url",value:r.website,onChange:m,placeholder:"https://tusitio.com"})]}),e.jsxs("button",{type:"button",className:s["optional-hide-btn"],onClick:()=>j(!1),children:[e.jsx("i",{className:"fas fa-minus-circle"}),"Ocultar campos opcionales"]})]}),e.jsxs("div",{className:s["modal-actions"],children:[e.jsx("button",{type:"button",className:s["btn-secondary"],onClick:B,children:"Cancelar"}),e.jsxs("button",{type:"submit",className:s["btn-primary"],children:[e.jsx("i",{className:"fas fa-paper-plane"}),f?"Guardar Cambios":"Enviar Testimonio"]})]})]})]})})}),"      ",x&&e.jsxs("form",{className:`${s["testimonial-form"]} ${s["admin-form"]}`,onSubmit:W,children:[e.jsxs("div",{className:s["form-row"],children:[e.jsx("input",{name:"name",value:r.name,onChange:m,placeholder:"Nombre",required:!0}),e.jsx("input",{name:"position",value:r.position,onChange:m,placeholder:"Puesto",required:!0})]}),e.jsx("textarea",{name:"text",value:r.text,onChange:m,placeholder:"Testimonio",required:!0}),e.jsxs("div",{className:s["form-row"],children:[e.jsx("input",{name:"email",type:"email",value:r.email,onChange:m,placeholder:"Email (opcional)"}),e.jsx("input",{name:"company",value:r.company,onChange:m,placeholder:"Empresa (opcional)"})]}),e.jsx("input",{name:"website",type:"url",value:r.website,onChange:m,placeholder:"Sitio web (opcional)"}),e.jsxs("div",{className:s["form-actions"],children:[e.jsx("button",{type:"submit",className:`${s["action-button"]} ${s.primary}`,children:f?"Guardar":"Añadir Testimonio"}),f&&e.jsx("button",{type:"button",className:s["action-button"],onClick:()=>{_(L),y(null)},children:"Cancelar"})]})]}),e.jsx("div",{className:"section-container",children:e.jsxs("div",{className:s["testimonials-grid"],children:[u.map(({id:a,name:t,position:o,avatar:g,text:i,company:d,website:h,rating:K,created_at:v},k)=>{const p=oe.has(a),P=re(i,p);return e.jsxs("div",{className:`${s["testimonial-card"]}${H===a||H===-1&&k===u.length-1?` ${s["testimonial-animate"]}`:""}`,style:{animationDelay:`${k*100}ms`},tabIndex:0,"aria-label":`Testimonio de ${t}`,children:["                  ",e.jsx("div",{className:s["testimonial-header"],children:e.jsx("div",{className:s["testimonial-avatar-wrapper"],children:e.jsx("img",{src:g,alt:`Avatar de ${t}`,className:s["testimonial-avatar"],onError:he})})}),"                  ",e.jsxs("div",{className:s["testimonial-body"],children:[e.jsxs("div",{className:s["testimonial-text-container"],"aria-expanded":p,"aria-controls":`testimonial-text-${a}`,children:[e.jsx("p",{className:`${s["testimonial-text"]}${p?` ${s.expanded}`:""}`,id:`testimonial-text-${a}`,children:P}),O(i)&&e.jsx("button",{className:s["read-more-btn"],onClick:()=>ce(a),"aria-expanded":p,"aria-controls":`testimonial-text-${a}`,"aria-label":p?"Contraer testimonio":"Expandir testimonio completo",children:p?"Leer menos":"Leer más"})]}),pe(K),v&&e.jsxs("div",{className:s["testimonial-date"],children:[e.jsx("i",{className:"fas fa-calendar-alt","aria-hidden":"true"}),e.jsx("span",{children:de(v)})]})]}),e.jsxs("div",{className:s["testimonial-footer"],children:[e.jsx("div",{className:s["testimonial-author"],children:e.jsxs("div",{className:s["author-info"],children:[e.jsx("span",{className:s["author-name"],children:t}),e.jsxs("span",{className:s["author-position"],children:[o,d&&` en ${d}`]}),h&&e.jsx("a",{href:h.startsWith("http")?h:`https://${h}`,target:"_blank",rel:"noopener noreferrer",className:s["author-website"],"aria-label":`Sitio web de ${t}`,title:"Visitar sitio web",children:e.jsx("i",{className:"fas fa-external-link-alt"})})]})}),x&&e.jsxs("div",{className:s["testimonial-actions"],children:[e.jsx("button",{className:s["edit-btn"],title:"Editar","aria-label":`Editar testimonio de ${t}`,onClick:()=>me({id:a,name:t,position:o,text:i,company:d,website:h}),children:e.jsx("i",{className:"fas fa-edit"})}),e.jsx("button",{className:s["delete-btn"],title:"Eliminar","aria-label":`Eliminar testimonio de ${t}`,onClick:()=>Z(a),children:e.jsx("i",{className:"fas fa-trash"})})]})]})]},a)}),"          ",u.length%3!==0&&Array.from({length:3-u.length%3}).map((a,t)=>e.jsx("div",{className:s["testimonial-placeholder"],"aria-hidden":"true"},`placeholder-${t}`))]})}),u.length===0&&e.jsxs("div",{className:s["empty-state"],children:[e.jsx("div",{className:s["empty-icon"],children:e.jsx("i",{className:"fas fa-comments"})}),e.jsx("h3",{className:s["empty-title"],children:"No hay testimonios disponibles"}),e.jsx("p",{className:s["empty-description"],children:x?"Añade el primer testimonio usando el formulario de arriba.":"¡Sé el primero en compartir tu experiencia!"})]}),se&&e.jsx(Ee,{actions:[...ee&&q?[{id:"admin-testimonials",onClick:x?()=>G(!0):q,icon:x?"fas fa-cog":"fas fa-shield-alt",label:"Gestionar Testimonios",color:"primary"}]:[],{id:"add-testimonial",onClick:()=>w(!0),icon:"fas fa-plus",label:"Añadir Testimonio",color:"success"}],position:"bottom-right"}),C&&e.jsx($e,{isOpen:C,onClose:je,title:"Administración de Testimonios",icon:"fas fa-comments",tabs:ge,onTabChange:ve,activeTab:c,floatingActions:[{id:"refresh-testimonials",label:"Actualizar",icon:"fas fa-sync",variant:"secondary",onClick:b},{id:"export-testimonials",label:"Exportar",icon:"fas fa-download",variant:"primary",onClick:()=>{S("Función de exportación en desarrollo")}}]})]})};export{qe as default};
